<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ê²Œì„í•˜ë©° íƒˆì¶œí•˜ê¸°</title>

    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Malgun Gothic', sans-serif; background-color: #333;
        }
        /* ì‹œì‘ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85); display: flex;
            justify-content: center; align-items: center; z-index: 2000; color: #333;
        }
        #start-content {
            background-color: white; padding: 30px 40px; border-radius: 15px;
            text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        #start-content h1 { margin-top: 0; }
        #start-content input {
            display: block; margin: 10px auto; width: 90%; padding: 10px;
            font-size: 16px; border: 1px solid #ccc; border-radius: 5px;
        }
        #start-game-btn {
            padding: 12px 30px; font-size: 18px; font-weight: bold; cursor: pointer;
            border: none; border-radius: 5px; background-color: #28a745; color: white; margin-top: 20px;
        }
        /* íƒ€ì´ë¨¸ ìŠ¤íƒ€ì¼ */
        #timer {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.6); color: white; padding: 8px 20px;
            border-radius: 10px; font-size: 24px; font-weight: bold; border: 2px solid #fff; z-index: 998;
        }
        /* ê²Œì„ ì»¨í…Œì´ë„ˆ */
        #game-container { position: relative; max-width: 1200px; margin: auto; border: 2px solid #000; }
        .room-background { width: 100%; display: block; }
        .clickable-object { position: absolute; cursor: pointer; z-index: 10; }
        #child-obj { top: 52%; left: 21%; width: 10%; height: 35%; }
        #computer-obj { top: 61%; left: 44%; width: 16%; height: 20%; }
        #wall-obj { top: 0; left: 80%; width: 20%; height: 100%; }
        /* ì¸ë²¤í† ë¦¬ ìŠ¤íƒ€ì¼ */
        #inventory {
            position: fixed; bottom: 20px; left: 20px; background-color: rgba(0, 0, 0, 0.7);
            color: white; padding: 10px 20px; border-radius: 10px; border: 2px solid #fff; z-index: 999;
        }
        #player-info {
            padding-bottom: 10px; margin-bottom: 10px; border-bottom: 1px solid #555;
            font-size: 14px; font-weight: bold;
        }
        #inventory h3 { margin: 0 0 10px 0; }
        #inventory ul { list-style: none; padding: 0; margin: 0; }
        /* ëª¨ë‹¬ ì°½ ìŠ¤íƒ€ì¼ */
        #modal-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); display: flex;
            justify-content: center; align-items: center; z-index: 1000;
        }
        #modal-content {
            background-color: white; padding: 20px; border-radius: 15px;
            text-align: center; max-width: 90%; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .hidden { display: none; }
        #modal-content button {
            padding: 10px 20px; font-size: 16px; cursor: pointer; border: none;
            border-radius: 5px; background-color: #4CAF50; color: white;
            margin-top: 15px; margin-left: 5px; margin-right: 5px;
        }
        #modal-content button.cancel-btn { background-color: #f44336; }
        #modal-content input {
            padding: 10px; font-size: 18px; text-align: center;
            border: 2px solid #ccc; border-radius: 5px; width: 80%;
        }
    </style>
</head>
<body>
    <div id="start-screen">
        <div id="start-content">
            <h1>ê²Œì„í•˜ë©° íƒˆì¶œí•˜ê¸°</h1>
            <p>ì°¸ì—¬ìì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
            <input type="text" id="player-grade" placeholder="í•™ë…„ (ì˜ˆ: 1)" autocomplete="off">
            <input type="text" id="player-class" placeholder="ë°˜ (ì˜ˆ: 3)" autocomplete="off">
            <input type="text" id="player-name" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)" autocomplete="off">
            <button id="start-game-btn">ê²Œì„ ì‹œì‘</button>
        </div>
    </div>
    <div id="timer" class="hidden">00:00</div>
    <div id="game-container" class="hidden">
        <img src="https://i.ibb.co/W4d22K57/Whisk-storyboard3cedccf3dfb44c8c89c740a1.jpg" alt="ê²Œì„ ë°°ê²½" class="room-background">
        <div id="child-obj" class="clickable-object"></div>
        <div id="computer-obj" class="clickable-object"></div>
        <div id="wall-obj" class="clickable-object"></div>
    </div>
    <div id="inventory" class="hidden">
        <div id="player-info"></div> 
        <h3>ğŸ“œ íšë“í•œ íŒíŠ¸</h3>
        <ul id="hint-list"></ul>
    </div>
    <div id="modal-container" class="hidden">
        <div id="modal-content"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // â˜… ë””ë²„ê¹… ë©”ì‹œì§€ 1: ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            console.log("í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œì‘.");

            const startScreen = document.getElementById('start-screen');
            const startGameBtn = document.getElementById('start-game-btn');
            const playerGradeInput = document.getElementById('player-grade');
            const playerClassInput = document.getElementById('player-class');
            const playerNameInput = document.getElementById('player-name');
            const playerInfoDiv = document.getElementById('player-info');
            const gameContainer = document.getElementById('game-container');
            const inventory = document.getElementById('inventory');
            const timerDiv = document.getElementById('timer');
            const childObj = document.getElementById('child-obj');
            const computerObj = document.getElementById('computer-obj');
            const wallObj = document.getElementById('wall-obj');
            const modalContainer = document.getElementById('modal-container');
            const modalContent = document.getElementById('modal-content');
            const hintList = document.getElementById('hint-list');

            let hints = new Set();
            let missileGame = { isRunning: false, animationFrameId: null, listeners: { keydown: null, keyup: null } };
            let startTime = 0;
            let timerInterval = null;

            function initGame() {
                console.log("initGame í•¨ìˆ˜ ì‹¤í–‰: íƒ€ì´ë¨¸ì™€ ê²Œì„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.");
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);
                childObj.addEventListener('click', showChildProblem);
                computerObj.addEventListener('click', startMissileGame);
                wallObj.addEventListener('click', showEscapeModal);
            }

            startGameBtn.addEventListener('click', () => {
                // â˜… ë””ë²„ê¹… ë©”ì‹œì§€ 2: ë²„íŠ¼ í´ë¦­ì´ ì¸ì‹ë˜ì—ˆëŠ”ì§€ í™•ì¸
                console.log("'ê²Œì„ ì‹œì‘' ë²„íŠ¼ í´ë¦­ë¨!");

                const grade = playerGradeInput.value.trim();
                const p_class = playerClassInput.value.trim();
                const name = playerNameInput.value.trim();

                if (!grade || !p_class || !name) {
                    alert('í•™ë…„, ë°˜, ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                playerInfoDiv.textContent = `ë„ì „ì: ${grade}í•™ë…„ ${p_class}ë°˜ ${name}`;

                startScreen.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                inventory.classList.remove('hidden');
                timerDiv.classList.remove('hidden');

                initGame();
            });
            
            function updateTimer() {
                const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                const minutes = String(Math.floor(elapsedTime / 60)).padStart(2, '0');
                const seconds = String(elapsedTime % 60).padStart(2, '0');
                timerDiv.textContent = `${minutes}:${seconds}`;
            }
            
            function showChildProblem() {
                if (hints.has("01")) { alert("ì´ë¯¸ íŒíŠ¸ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤."); return; }
                modalContent.innerHTML = `<h2>ì¹œêµ¬ì˜ ìª½ì§€</h2><p>"ë‚´ ìƒì¼ì€ 1ì›”ì´ì•¼. ì´ê±¸ë¡œ ì²« ë²ˆì§¸ íŒíŠ¸ë¥¼ í’€ì–´ë´!"</p><button id="close-modal-btn">í™•ì¸</button>`;
                showModal();
                document.getElementById('close-modal-btn').onclick = () => {
                    addHint("ì¹œêµ¬ì˜ ìƒì¼ = 01"); hints.add("01"); closeModal();
                };
            }

            function startMissileGame() {
                if (hints.has("15")) { alert("ê²Œì„ì€ ì´ë¯¸ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤."); return; }
                modalContent.innerHTML = `
                    <h2>ë¯¸ì‚¬ì¼ ê²Œì„</h2><p>ë‚ ì•„ì˜¤ëŠ” ìš´ì„ì„ ëª¨ë‘ íŒŒê´´í•˜ì„¸ìš”!</p>
                    <canvas id="game-canvas" width="480" height="320" style="background-color: #1a1a2e;"></canvas>
                    <div>í‚¤ë³´ë“œ: â† â†’ / ìŠ¤í˜ì´ìŠ¤ë°”</div>
                    <button id="giveup-missile-game" class="cancel-btn">í¬ê¸°í•˜ê³  ë‹«ê¸°</button>`;
                showModal();
                document.getElementById('giveup-missile-game').onclick = () => { stopMissileGame(); closeModal(); };
                setTimeout(runGame, 50);
            }

            function showEscapeModal() {
                modalContent.innerHTML = `
                    <h2>ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2><p>íšë“í•œ íŒíŠ¸ë¥¼ ì¡°í•©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                    <input type="text" id="password-input" maxlength="4" placeholder="4ìë¦¬ ìˆ«ì" autocomplete="off">
                    <button id="submit-password">íƒˆì¶œ ì‹œë„</button><button id="cancel-escape" class="cancel-btn">ì·¨ì†Œ</button>`;
                showModal();
                document.getElementById('submit-password').onclick = () => {
                    if (document.getElementById('password-input').value === "0115") {
                        clearInterval(timerInterval);
                        const finalTime = timerDiv.textContent;
                        alert(`ì •ë‹µ! ë¬¸ì´ ì—´ë¦½ë‹ˆë‹¤. íƒˆì¶œ ì„±ê³µ!\n\nì†Œìš”ì‹œê°„: ${finalTime}`);
                        window.location.reload();
                    } else { alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."); }
                };
                document.getElementById('cancel-escape').onclick = closeModal;
            }

            function addHint(text) {
                if ([...hintList.children].some(li => li.textContent === text)) return;
                const newHint = document.createElement('li');
                newHint.textContent = text;
                hintList.appendChild(newHint);
            }

            function showModal() { modalContainer.classList.remove('hidden'); }
            function closeModal() { modalContainer.classList.add('hidden'); }
            
            function stopMissileGame() {
                if (missileGame.isRunning) {
                    document.removeEventListener('keydown', missileGame.listeners.keydown);
                    document.removeEventListener('keyup', missileGame.listeners.keyup);
                    cancelAnimationFrame(missileGame.animationFrameId);
                    missileGame.isRunning = false;
                    missileGame.listeners.keydown = null;
                    missileGame.listeners.keyup = null;
                }
            }
            
            function runGame() {
                const canvas = document.getElementById('game-canvas');
                if (!canvas || missileGame.isRunning) return;
                const ctx = canvas.getContext('2d');
                missileGame.isRunning = true;
                let player = { x: canvas.width / 2 - 15, y: canvas.height - 30, width: 30, height: 20, speed: 5 };
                let bullets = []; let targets = []; let keys = {};
                for(let i=0; i<5; i++) { targets.push({x: 50 + i * 80, y: 30, width: 40, height: 20, active: true}); }
                missileGame.listeners.keydown = (e) => { keys[e.code] = true; };
                missileGame.listeners.keyup = (e) => { keys[e.code] = false; };
                document.addEventListener('keydown', missileGame.listeners.keydown);
                document.addEventListener('keyup', missileGame.listeners.keyup);
                function gameLoop() {
                    if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
                    if (keys['ArrowRight'] && player.x < canvas.width - player.width) player.x += player.speed;
                    if (keys['Space']) {
                        if (bullets.length < 5) { bullets.push({x: player.x + player.width/2 - 2.5, y: player.y, width: 5, height: 10, speed: 7}); }
                        keys['Space'] = false;
                    }
                    for (let bIndex = bullets.length - 1; bIndex >= 0; bIndex--) {
                        let bullet = bullets[bIndex]; bullet.y -= bullet.speed;
                        if (bullet.y < 0) { bullets.splice(bIndex, 1); continue; }
                        for (let tIndex = targets.length - 1; tIndex >= 0; tIndex--) {
                            let target = targets[tIndex];
                            if (target.active && bullet.x < target.x + target.width && bullet.x + bullet.width > target.x &&
                                bullet.y < target.y + target.height && bullet.y + bullet.height > target.y) {
                                target.active = false; bullets.splice(bIndex, 1); break; 
                            }
                        }
                    }
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#16a085'; ctx.fillRect(player.x, player.y, player.width, player.height);
                    ctx.fillStyle = '#f1c40f'; bullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));
                    ctx.fillStyle = '#e74c3c'; targets.forEach(t => { if(t.active) ctx.fillRect(t.x, t.y, t.width, t.height); });
                    if (targets.every(t => !t.active)) {
                        stopMissileGame();
                        setTimeout(() => {
                            alert("ê²Œì„ í´ë¦¬ì–´! ë‘ ë²ˆì§¸ íŒíŠ¸ '15'ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.");
                            addHint("ê²Œì„ í´ë¦¬ì–´ ì ìˆ˜ = 15"); hints.add("15"); closeModal();
                        }, 200);
                        return;
                    }
                    if (missileGame.isRunning) {
                        missileGame.animationFrameId = requestAnimationFrame(gameLoop);
                    }
                }
                gameLoop();
            }
        });
    </script>

</body>
</html>